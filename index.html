<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenwin TravelPack Portal | IT Support & System Access</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
            },
            colors: {
              greenwin: {
                primary: '#00543d', // Deep Green
                accent: '#7ac143', // Light Green
                dark: '#003d2a',   // Even deeper green for contrast
                light: '#e6f4ea',  // Very light green for backgrounds
              },
              error: '#dc3545',
              success: '#28a745',
              border: '#e5e7eb',
            },
          },
        },
      }
    </script>
    <style>
        :root {
            --greenwin-primary: #00543d;
            --greenwin-accent: #7ac143;
            --greenwin-dark: #003d2a;
            --greenwin-light: #e6f4ea;
            --error: #dc3545;
            --success: #28a745;
            --border: #e5e7eb;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
        }
        
        .loading {
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .alert {
            padding: 16px;
            border-radius: 8px;
            margin: 16px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .alert-error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffecb5;
            color: #856404;
        }
        
        /* Placeholder text styling */
        input::placeholder,
        textarea::placeholder,
        select::placeholder {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: #9ca3af;
            opacity: 1;
        }
        
        /* Firefox specific placeholder styling */
        input::-moz-placeholder,
        textarea::-moz-placeholder {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: #9ca3af;
            opacity: 1;
        }
        
        /* WebKit browsers placeholder styling */
        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            font-size: 14px;
            font-weight: 400;
            color: #9ca3af;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-greenwin-light via-white to-greenwin-accent min-h-screen font-sans">
    <header class="w-full sticky top-0 z-50 backdrop-blur-md bg-white/80 shadow-md border-b border-greenwin-light">
        <div class="max-w-2xl mx-auto flex flex-col items-center py-12 px-4">
            <div class="flex flex-col items-center">
                <div class="text-greenwin-primary text-2xl md:text-3xl font-bold tracking-tight mb-2">Greenwin Corp</div>
            </div>
            <div class="text-center">
                <h1 class="text-2xl md:text-3xl font-bold text-greenwin-primary leading-tight mb-3 drop-shadow">Travel Approval</h1>
                <p class="text-gray-500 text-base tracking-wide font-medium mb-2">International Travel & System Access Request</p>
            </div>
        </div>
        <div class="w-full h-1 bg-gradient-to-r from-greenwin-accent via-greenwin-primary to-greenwin-accent opacity-70 rounded-full shadow"></div>
    </header>

    <main class="max-w-2xl mx-auto px-2 md:px-0 py-10 flex flex-col gap-10">
        <section class="rounded-2xl shadow-xl border border-greenwin-light bg-white/70 backdrop-blur-md p-6 md:p-10 mb-6">
            <div class="flex items-center gap-3 mb-4">
                <i class="fas fa-clock text-greenwin-primary text-2xl"></i>
                <span class="font-semibold text-lg text-greenwin-primary">Processing Timeline</span>
            </div>
            <div class="text-greenwin-dark text-base">
                <span class="font-bold text-greenwin-primary">Recommended:</span> Submit this form at least <span class="font-bold text-greenwin-primary">4 business days before departure</span> to ensure IT Support can configure conditional access policies for your destination. For weekend or Monday departures, additional lead time may be required. While you can submit requests with shorter notice, processing may be delayed.
            </div>
        </section>

        <section class="rounded-2xl shadow-xl border border-greenwin-light bg-white/80 backdrop-blur-md p-6 md:p-10 mb-8">
            <form id="travelForm" action="mailto:ITSupport@greenwin.ca" method="POST" enctype="text/plain" class="flex flex-col gap-10">
                <!-- Employee Information -->
                <div>
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-user text-greenwin-primary text-2xl"></i>
                        <span class="font-bold text-xl text-greenwin-primary">Employee Information</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <label for="fullName" class="block text-sm font-semibold text-greenwin-primary mb-2">Full Name <span class="text-greenwin-accent font-bold">*</span></label>
                            <input type="text" id="fullName" name="fullName" autocomplete="name" required placeholder="Enter your full name" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                        </div>
                                                  <div>
                              <label for="email" class="block text-sm font-semibold text-greenwin-primary mb-2">Email Address <span class="text-greenwin-accent font-bold">*</span></label>
                              <input type="email" id="email" name="email" autocomplete="email" required placeholder="jsmith@greenwin.ca" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                              <div class="text-sm text-gray-400 mt-2">Format: first letter + last name @greenwin.ca</div>
                          </div>
                        <div>
                            <label for="phone" class="block text-sm font-semibold text-greenwin-primary mb-2">Phone Number <span class="text-greenwin-accent font-bold">*</span></label>
                            <input type="tel" id="phone" name="phone" autocomplete="tel" required placeholder="+1 (555) 123-4567" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                        </div>
                        <div>
                            <label for="manager" class="block text-sm font-semibold text-greenwin-primary mb-2">Manager/Supervisor Email <span class="text-greenwin-accent font-bold">*</span></label>
                            <input type="email" id="manager" name="manager" autocomplete="email" required placeholder="mjohnson@greenwin.ca" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                            <div class="text-sm text-gray-400 mt-2">Format: first letter of first name + full last name @greenwin.ca</div>
                        </div>
                        <div class="md:col-span-2">
                            <label for="department" class="block text-sm font-semibold text-greenwin-primary mb-2">Department <span class="text-greenwin-accent font-bold">*</span></label>
                            <select id="department" name="department" autocomplete="organization-title" required class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                                <option value="">Select your department</option>
                                <option value="Finance">Finance</option>
                                <option value="IT">IT</option>
                                <option value="Human Resources">Human Resources</option>
                                <option value="Research">Research</option>
                                <option value="Operations">Operations</option>
                                <option value="Marketing/Leasing">Marketing/Leasing</option>
                                <option value="Construction Development">Construction Development</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!-- Travel Details -->
                <div>
                    <div class="flex items-center gap-3 mb-6">
                        <i class="fas fa-globe text-greenwin-primary text-2xl"></i>
                        <span class="font-bold text-xl text-greenwin-primary">Travel Details</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-6 date-grid">
                        <div>
                            <label for="startDate" class="block text-sm font-semibold text-greenwin-primary mb-2">Departure Date <span class="text-greenwin-accent font-bold">*</span></label>
                            <input type="date" id="startDate" name="startDate" required class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                        </div>
                        <div>
                            <label for="endDate" class="block text-sm font-semibold text-greenwin-primary mb-2">Return Date <span class="text-greenwin-accent font-bold">*</span></label>
                            <input type="date" id="endDate" name="endDate" required class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-greenwin-primary mb-2">Duration</label>
                            <div class="rounded-xl border border-greenwin-light bg-gray-50 px-5 py-4 text-center font-semibold text-greenwin-primary text-base shadow-sm transition" id="duration">-</div>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label for="destination" class="block text-sm font-semibold text-greenwin-primary mb-2">Destination Country <span class="text-greenwin-accent font-bold">*</span></label>
                        <select id="destination" name="destination" required class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition">
                            <option value="">Select destination country</option>
                            <option value="United States">United States</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="France">France</option>
                            <option value="Germany">Germany</option>
                            <option value="Japan">Japan</option>
                            <option value="Australia">Australia</option>
                            <option value="China">China</option>
                            <option value="India">India</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Mexico">Mexico</option>
                            <option value="Italy">Italy</option>
                            <option value="Spain">Spain</option>
                            <option value="Netherlands">Netherlands</option>
                            <option value="Switzerland">Switzerland</option>
                            <option value="Sweden">Sweden</option>
                            <option value="Norway">Norway</option>
                            <option value="Denmark">Denmark</option>
                            <option value="Finland">Finland</option>
                            <option value="Belgium">Belgium</option>
                            <option value="Austria">Austria</option>
                            <option value="Ireland">Ireland</option>
                            <option value="Portugal">Portugal</option>
                            <option value="Greece">Greece</option>
                            <option value="Poland">Poland</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Singapore">Singapore</option>
                            <option value="New Zealand">New Zealand</option>
                            <option value="South Africa">South Africa</option>
                            <option value="Argentina">Argentina</option>
                            <option value="Chile">Chile</option>
                            <option value="Thailand">Thailand</option>
                            <option value="Indonesia">Indonesia</option>
                            <option value="Other">Other (specify in purpose)</option>
                        </select>
                    </div>
                    <div class="mb-6">
                        <label for="purpose" class="block text-sm font-semibold text-greenwin-primary mb-2">Purpose & System Requirements</label>
                        <textarea id="purpose" name="purpose" placeholder="Describe the purpose of your travel and specify which company systems you'll need access to (email, SharePoint, Teams, CRM, etc.)" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition min-h-[100px]"></textarea>
                    </div>
                    <div>
                        <label for="devices" class="block text-sm font-semibold text-greenwin-primary mb-2">Company Devices <span class="text-greenwin-accent font-bold">*</span></label>
                        <textarea id="devices" name="devices" required placeholder="List all company devices you'll be traveling with (laptop model, phone model, tablet, etc.)" class="w-full rounded-xl border border-greenwin-light px-5 py-4 focus:ring-2 focus:ring-greenwin-accent focus:outline-none text-base shadow-sm transition min-h-[80px]"></textarea>
                    </div>
                </div>
                <!-- Acknowledgments & Compliance -->
                <div class="rounded-2xl shadow-2xl border border-greenwin-light bg-gradient-to-br from-greenwin-light/60 via-white/80 to-greenwin-accent/30 backdrop-blur-md p-8 md:p-12 flex flex-col items-center">
                    <div class="flex flex-col items-center mb-6">
                        <div class="flex items-center justify-center w-16 h-16 rounded-full bg-greenwin-accent/20 mb-3">
                            <i class="fas fa-check-circle text-greenwin-accent text-4xl"></i>
                        </div>
                        <span class="font-bold text-xl text-greenwin-primary mb-2">Acknowledgments & Compliance</span>
                    </div>
                    <div class="flex flex-col w-full max-w-2xl gap-0 divide-y divide-greenwin-light/60">
                        <label class="flex items-start gap-4 py-5 cursor-pointer text-base text-greenwin-dark">
                            <input type="checkbox" id="systemAccess" name="systemAccess" required class="mt-1 accent-greenwin-accent w-7 h-7 rounded-xl border-2 border-greenwin-light focus:ring-2 focus:ring-greenwin-accent transition-all duration-200">
                            <span class="flex-1">I understand that IT Support will configure Microsoft Exchange conditional access policies for my travel destination to maintain access to company systems. <span class="text-greenwin-accent font-bold">*</span></span>
                        </label>
                        <label class="flex items-start gap-4 py-5 cursor-pointer text-base text-greenwin-dark">
                            <input type="checkbox" id="deviceCompliance" name="deviceCompliance" required class="mt-1 accent-greenwin-accent w-7 h-7 rounded-xl border-2 border-greenwin-light focus:ring-2 focus:ring-greenwin-accent transition-all duration-200">
                            <span class="flex-1">I confirm all company devices are up-to-date with security patches and will comply with any additional security policies applied during travel. <span class="text-greenwin-accent font-bold">*</span></span>
                        </label>
                        <label class="flex items-start gap-4 py-5 cursor-pointer text-base text-greenwin-dark">
                            <input type="checkbox" id="authRequirement" name="authRequirement" required class="mt-1 accent-greenwin-accent w-7 h-7 rounded-xl border-2 border-greenwin-light focus:ring-2 focus:ring-greenwin-accent transition-all duration-200">
                            <span class="flex-1">I understand that secure authentication protocols and MFA are required for all company system access while traveling abroad. <span class="text-greenwin-accent font-bold">*</span></span>
                        </label>
                        <label class="flex items-start gap-4 py-5 cursor-pointer text-base text-greenwin-dark">
                            <input type="checkbox" id="itSupport" name="itSupport" required class="mt-1 accent-greenwin-accent w-7 h-7 rounded-xl border-2 border-greenwin-light focus:ring-2 focus:ring-greenwin-accent transition-all duration-200">
                            <span class="flex-1">I will contact ITSupport@greenwin.ca for any technical issues and understand that system access may be temporarily restricted for security purposes. <span class="text-greenwin-accent font-bold">*</span></span>
                        </label>
                        <label class="flex items-start gap-4 py-5 cursor-pointer text-base text-greenwin-dark">
                            <input type="checkbox" id="dataCompliance" name="dataCompliance" required class="mt-1 accent-greenwin-accent w-7 h-7 rounded-xl border-2 border-greenwin-light focus:ring-2 focus:ring-greenwin-accent transition-all duration-200">
                            <span class="flex-1">I agree that this information will be used by IT Support to configure secure access policies and understand all system activity will be monitored during travel. <span class="text-greenwin-accent font-bold">*</span></span>
                        </label>
                    </div>
                </div>
                <!-- Submit Button -->
                <div class="flex flex-col gap-2 mt-4">
                    <button type="submit" class="submit-btn bg-greenwin-primary hover:bg-greenwin-accent text-white font-bold py-4 rounded-full flex items-center justify-center gap-3 text-base transition-all duration-200 shadow-lg border-0 focus:ring-4 focus:ring-greenwin-accent/30">
                        <span class="loading hidden"></span>
                        <i class="fas fa-paper-plane"></i>
                        <span>Submit for Approval</span>
                    </button>
                </div>
            </form>
        </section>

        <section class="flex flex-col gap-6">
            <div class="flex items-start gap-5 rounded-2xl shadow-xl border border-greenwin-light bg-gradient-to-br from-white/80 to-greenwin-light/60 backdrop-blur-md p-6">
                <div class="flex-shrink-0 flex items-center justify-center w-14 h-14 rounded-xl bg-greenwin-primary/10">
                    <i class="fas fa-server text-greenwin-primary text-3xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-greenwin-primary text-base mb-1">System Access Configuration</div>
                    <ul class="list-disc list-inside text-greenwin-dark text-sm ml-2">
                        <li>Microsoft Exchange conditional access policies</li>
                        <li>SharePoint and Teams international access</li>
                        <li>OneDrive sync authentication protocols</li>
                        <li>Office 365 application compliance settings</li>
                        <li>Multi-factor authentication requirements</li>
                        <li>System access monitoring and logging</li>
                    </ul>
                </div>
            </div>
            <div class="flex items-start gap-5 rounded-2xl shadow-xl border border-greenwin-light bg-gradient-to-br from-white/80 to-greenwin-light/60 backdrop-blur-md p-6">
                <div class="flex-shrink-0 flex items-center justify-center w-14 h-14 rounded-xl bg-greenwin-primary/10">
                    <i class="fas fa-mobile-alt text-greenwin-primary text-3xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-greenwin-primary text-base mb-1">Device Requirements</div>
                    <ul class="list-disc list-inside text-greenwin-dark text-sm ml-2">
                        <li>International roaming enabled on company phones</li>
                        <li>Microsoft Authenticator app installed</li>
                        <li>Company system connectivity tested</li>
                        <li>Wi-Fi certificates updated for international use</li>
                        <li>Outlook and Teams mobile apps configured</li>
                    </ul>
                </div>
            </div>
            <div class="flex items-start gap-5 rounded-2xl shadow-xl border border-greenwin-light bg-gradient-to-br from-white/80 to-greenwin-light/60 backdrop-blur-md p-6">
                <div class="flex-shrink-0 flex items-center justify-center w-14 h-14 rounded-xl bg-greenwin-primary/10">
                    <i class="fas fa-headset text-greenwin-primary text-3xl"></i>
                </div>
                <div>
                    <div class="font-semibold text-greenwin-primary text-base mb-1">IT Support Contact</div>
                    <div class="text-greenwin-dark text-sm">
                        <div><span class="font-semibold">Email:</span> ITSupport@greenwin.ca</div>
                        <div><span class="font-semibold">Response Time:</span> 24-48 hours for travel requests</div>
                        <div><span class="font-semibold">Emergency Support:</span> Available for critical issues during travel</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer class="w-full bg-white/70 backdrop-blur-md text-greenwin-primary text-center py-6 mt-10 text-sm font-semibold tracking-wide shadow-inner border-t border-greenwin-light">
        &copy; 2025 Greenwin Corp &mdash; All Rights Reserved | <a href="https://www.greenwin.ca" class="underline hover:text-greenwin-accent transition">www.greenwin.ca</a>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Calculate duration automatically
            function calculateDuration() {
                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;
                const durationDisplay = document.getElementById('duration');
                
                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    const diffTime = end - start;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
                    
                                         if (diffDays > 0) {
                         durationDisplay.textContent = `${diffDays} day${diffDays > 1 ? 's' : ''}`;
                         durationDisplay.style.color = 'var(--greenwin-primary)';
                     } else {
                         durationDisplay.textContent = 'Invalid dates';
                         durationDisplay.style.color = 'var(--error)';
                     }
                 } else {
                     durationDisplay.textContent = '-';
                     durationDisplay.style.color = 'var(--text-muted)';
                 }
            }

            // Add event listeners for date changes
            document.getElementById('startDate').addEventListener('change', calculateDuration);
            document.getElementById('endDate').addEventListener('change', calculateDuration);

            // Form validation and submission
            document.getElementById('travelForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Capture form reference for use in setTimeout
                const form = this;
                const submitBtn = document.querySelector('.submit-btn');
                const loading = submitBtn.querySelector('.loading');
                const btnText = submitBtn.querySelector('span:last-child');
                
                // Show loading state
                submitBtn.disabled = true;
                loading.style.display = 'inline-block';
                btnText.textContent = 'Processing...';
                
                // Validate all required fields
                const requiredFields = ['fullName', 'email', 'phone', 'manager', 'startDate', 'endDate', 'destination', 'devices'];
                const requiredCheckboxes = ['systemAccess', 'deviceCompliance', 'authRequirement', 'itSupport', 'dataCompliance'];
                
                let isValid = true;
                let errorMessage = '';
                
                // Check required fields
                requiredFields.forEach(field => {
                    const element = document.getElementById(field);
                    if (!element.value.trim()) {
                        element.style.borderColor = 'var(--error)';
                        element.style.boxShadow = '0 0 0 3px rgba(220, 53, 69, 0.1)';
                        isValid = false;
                    } else {
                        element.style.borderColor = 'var(--border)';
                        element.style.boxShadow = 'none';
                    }
                });
                
                // Check required checkboxes
                requiredCheckboxes.forEach(checkbox => {
                    const element = document.getElementById(checkbox);
                    const label = element.closest('label');
                    if (!element.checked) {
                        label.style.backgroundColor = 'rgba(220, 53, 69, 0.05)';
                        label.style.borderLeft = '4px solid var(--error)';
                        label.style.paddingLeft = '16px';
                        isValid = false;
                    } else {
                        label.style.backgroundColor = '';
                        label.style.borderLeft = '';
                        label.style.paddingLeft = '';
                    }
                });
                
                // Validate email format
                const email = document.getElementById('email').value;
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (email && !emailRegex.test(email)) {
                    document.getElementById('email').style.borderColor = 'var(--error)';
                    isValid = false;
                    errorMessage = 'Please enter a valid email address.';
                }
                
                // Validate date range
                const startDate = new Date(document.getElementById('startDate').value);
                const endDate = new Date(document.getElementById('endDate').value);
                
                if (startDate && endDate && endDate <= startDate) {
                    document.getElementById('endDate').style.borderColor = 'var(--error)';
                    isValid = false;
                    errorMessage = 'Return date must be after departure date.';
                }
                
                console.log('Processing form submission...');
                
                // Process form submission
                setTimeout(() => {
                    try {
                        console.log('Form validation result:', isValid);
                        
                        if (isValid) {
                        // Create simplified email body for better Windows compatibility
                        const formData = new FormData(form);
                        const duration = document.getElementById('duration').textContent;
                        
                        // Create a shorter, simpler email body
                        const emailBody = `Dear ${formData.get('manager')},

Please review and approve this travel request, then forward to ITSupport@greenwin.ca:

TRAVEL REQUEST - ${formData.get('fullName')}
Employee: ${formData.get('fullName')} (${formData.get('email')})
Phone: ${formData.get('phone')}
Department: ${formData.get('department') || 'Not specified'}

Travel Dates: ${formData.get('startDate')} to ${formData.get('endDate')} (${duration})
Destination: ${formData.get('destination')}

Purpose: ${formData.get('purpose') || 'Not specified'}

Company Devices: ${formData.get('devices')}

RECOMMENDED: 4 business days advance notice for optimal processing.
After approval, forward to ITSupport@greenwin.ca for system configuration.

Generated by Greenwin TravelPack Portal - ${new Date().toLocaleDateString()}`;

                        // Create detailed content for clipboard/fallback
                        const detailedContent = `To: ${formData.get('manager')}
CC: ${ccList}
BCC: nkhan@greenwin.ca
Subject: [APPROVAL NEEDED] Travel Request - ${formData.get('fullName')} - ${formData.get('destination')}

Dear ${formData.get('manager')},

Please review and approve the following travel request. Once approved, kindly forward this email to ITSupport@greenwin.ca for system access configuration.

GREENWIN TRAVELPACK REQUEST
------------------------------------------

Employee Details:
â€¢ Full Name: ${formData.get('fullName')}
â€¢ Email: ${formData.get('email')}
â€¢ Phone: ${formData.get('phone')}
â€¢ Department: ${formData.get('department') || 'Not specified'}

Travel Information:
â€¢ Departure Date: ${formData.get('startDate')}
â€¢ Return Date: ${formData.get('endDate')}
â€¢ Duration: ${duration}
â€¢ Destination: ${formData.get('destination')}

Purpose:
${formData.get('purpose') || 'Not specified'}

Company Devices:
${formData.get('devices')}

REQUIRED IT ACTIONS AFTER APPROVAL:
1. Configure Microsoft Exchange access for ${formData.get('destination')}
2. Enable international Office 365 access
3. Apply travel security policies
4. Configure authentication protocols
5. Setup system monitoring

TIMELINE RECOMMENDATIONS:
â€¢ IT recommends minimum 4 business days advance notice for optimal processing
â€¢ For weekend or Monday departures, submit earlier if possible
â€¢ Please forward to ITSupport@greenwin.ca after approval
â€¢ IT configuration and testing cannot begin without manager approval
â€¢ Short notice submissions may result in delayed system access

Generated by: Greenwin TravelPack Portal
Request Date: ${new Date().toLocaleDateString()}`;

                        // Get manager's email from the form
                        const managerEmail = document.getElementById('manager').value;
                        
                        // Department to approver email mapping
                        const departmentApproverMap = {
                            'Finance': 'mannable@greenwin.ca',
                            'IT': 'mannable@greenwin.ca',
                            'Human Resources': 'mannable@greenwin.ca',
                            'Research': 'mannable@greenwin.ca',
                            'Operations': 'akeresztes@greenwin.ca',
                            'Marketing/Leasing': 'akeresztes@greenwin.ca',
                            'Construction Development': 'lwagner@greenwin.ca',
                        };
                        
                        const department = formData.get('department');
                        const ccList = departmentApproverMap[department] || '';
                        
                        // Create simplified mailto link
                        const subject = `Travel Request - ${formData.get('fullName')} - ${formData.get('destination')}`;
                        const simpleMailtoLink = `mailto:${managerEmail}?cc=${encodeURIComponent(ccList)}&bcc=${encodeURIComponent('nkhan@greenwin.ca')}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(emailBody)}`;

                        // Try to open the mail client
                        let emailOpened = false;
                        try {
                            // Copy to clipboard first as backup
                            if (navigator.clipboard && window.isSecureContext) {
                                navigator.clipboard.writeText(detailedContent).catch(err => 
                                    console.log('Clipboard copy failed:', err)
                                );
                            }
                            
                            // Attempt to open email client
                            window.location.href = simpleMailtoLink;
                            emailOpened = true;
                            console.log('Email client opened successfully');
                        } catch (error) {
                            console.log('Failed to open email client:', error);
                            emailOpened = false;
                        }
                        
                        // Always show the modal after a short delay
                        setTimeout(() => {
                            const modal = document.createElement('div');
                            modal.style.cssText = `
                                position: fixed;
                                top: 50%;
                                left: 50%;
                                transform: translate(-50%, -50%);
                                background: white;
                                padding: 32px;
                                border-radius: 12px;
                                box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                                z-index: 1000;
                                max-width: 600px;
                                width: 90%;
                                max-height: 80vh;
                                overflow-y: auto;
                            `;
                            
                            modal.innerHTML = `
                                <div style="text-align: center; margin-bottom: 24px;">
                                    <i class="fas fa-envelope" style="font-size: 48px; color: var(--accent); margin-bottom: 16px;"></i>
                                    <h2 style="margin: 0; color: var(--text-primary);">Email Your Manager</h2>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 24px;">
                                    <p style="margin: 0; color: var(--text-secondary); font-size: 14px;">
                                        <strong>Next Steps:</strong><br>
                                        1. ${emailOpened ? 'Your email client should have opened' : 'Open your email client manually'}<br>
                                        2. The complete email content is copied to your clipboard<br>
                                        3. Paste the content into a new email to: <strong>${managerEmail}</strong><br>
                                        4. Send the email for manager approval
                                    </p>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px;">
                                    <button onclick="window.open('https://outlook.office.com/compose', '_blank')" 
                                            style="padding: 12px 20px; background: #0078d4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                        <i class="fas fa-external-link-alt"></i> Open Outlook Web
                                    </button>
                                    <button onclick="copyEmailContent()" 
                                            style="padding: 12px 20px; background: var(--accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 14px;">
                                        <i class="fas fa-copy"></i> Copy Content Again
                                    </button>
                                </div>
                                
                                <div style="border: 1px solid #ddd; border-radius: 6px; padding: 16px; background: #fff; max-height: 200px; overflow-y: auto; font-family: monospace; font-size: 12px; margin-bottom: 16px;">
                                    ${detailedContent.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;')}
                                </div>
                                
                                <button onclick="this.closest('div').remove(); document.querySelector('.modal-overlay').remove()" 
                                        style="padding: 12px 24px; background: var(--success); color: white; border: none; border-radius: 6px; cursor: pointer; width: 100%; font-size: 16px;">
                                    <i class="fas fa-check"></i> Done - Email Sent
                                </button>
                            `;
                            
                            // Create overlay
                            const overlay = document.createElement('div');
                            overlay.className = 'modal-overlay';
                            overlay.style.cssText = `
                                position: fixed;
                                top: 0;
                                left: 0;
                                right: 0;
                                bottom: 0;
                                background: rgba(0, 0, 0, 0.6);
                                z-index: 999;
                            `;
                                                         
                             document.body.appendChild(overlay);
                             document.body.appendChild(modal);
                             
                             // Make copy function available globally
                             window.copyEmailContent = () => {
                                 if (navigator.clipboard && window.isSecureContext) {
                                     navigator.clipboard.writeText(detailedContent)
                                         .then(() => {
                                             console.log('Content copied to clipboard');
                                             // Show brief feedback
                                             const btn = document.querySelector('button[onclick="copyEmailContent()"]');
                                             if (btn) {
                                                 const originalText = btn.innerHTML;
                                                 btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
                                                 btn.style.background = 'var(--success)';
                                                 setTimeout(() => {
                                                     btn.innerHTML = originalText;
                                                     btn.style.background = 'var(--accent)';
                                                 }, 2000);
                                             }
                                         })
                                         .catch(err => console.log('Copy failed:', err));
                                 } else {
                                     // Fallback for older browsers
                                     const textarea = document.createElement('textarea');
                                     textarea.value = detailedContent;
                                     textarea.style.position = 'fixed';
                                     textarea.style.opacity = '0';
                                     document.body.appendChild(textarea);
                                     textarea.select();
                                     try {
                                         document.execCommand('copy');
                                         console.log('Content copied using fallback method');
                                     } catch (err) {
                                         console.log('Copy failed:', err);
                                     }
                                     document.body.removeChild(textarea);
                                 }
                             };
                             
                         }, 500);
                        
                        // Show success message
                        const successAlert = document.createElement('div');
                        successAlert.className = 'alert alert-success';
                        successAlert.innerHTML = `
                            <i class="fas fa-check-circle"></i>
                            <strong>Travel Request Processed!</strong><br>
                            â€¢ A detailed email has been prepared for your manager<br>
                            â€¢ Content has been copied to your clipboard<br>
                            â€¢ Follow the instructions in the popup to complete your submission<br>
                            â€¢ Your manager will review and forward to IT Support after approval
                        `;
                        
                        document.querySelector('main').insertBefore(
                            successAlert, 
                            document.querySelector('section')
                        );
                        
                        // Scroll to success message
                        successAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        
                    } else {
                        // Show error message
                        const errorAlert = document.createElement('div');
                        errorAlert.className = 'alert alert-error';
                        errorAlert.innerHTML = `
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Validation Error</strong> ${errorMessage || 'Please fill in all required fields and complete all acknowledgments.'}
                        `;
                        
                        // Remove existing alerts
                        const existingAlert = document.querySelector('.alert');
                        if (existingAlert) {
                            existingAlert.remove();
                        }
                        
                        document.querySelector('main').insertBefore(
                            errorAlert, 
                            document.querySelector('section')
                        );
                        
                        // Scroll to error message
                        errorAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    
                    } catch (error) {
                        console.error('Error during form submission:', error);
                        console.error('Error details:', error.message);
                        console.error('Error stack:', error.stack);
                        
                        // Show error message
                        const errorAlert = document.createElement('div');
                        errorAlert.className = 'alert alert-error';
                        errorAlert.innerHTML = `
                            <i class="fas fa-exclamation-triangle"></i>
                            <strong>Submission Error</strong> There was an error processing your request. Please try again or contact IT Support.
                            <div class="text-sm mt-2">Error: ${error.message}</div>
                        `;
                        
                        // Remove existing alerts
                        const existingAlert = document.querySelector('.alert');
                        if (existingAlert) {
                            existingAlert.remove();
                        }
                        
                        document.querySelector('main').insertBefore(
                            errorAlert, 
                            document.querySelector('section')
                        );
                        
                        errorAlert.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                    
                    // Reset button state (always execute)
                    submitBtn.disabled = false;
                    loading.style.display = 'none';
                    btnText.textContent = 'Submit for Approval';
                    
                }, 800);
            });

            // Helper function to calculate business days for warnings (no longer restricts input)
            function addBusinessDays(date, days) {
                let result = new Date(date);
                let addedDays = 0;
                while (addedDays < days) {
                    result.setDate(result.getDate() + 1);
                    if (result.getDay() !== 0 && result.getDay() !== 6) {
                        addedDays++;
                    }
                }
                return result;
            }

            const today = new Date();
            const recommendedMinDate = addBusinessDays(today, 4);
            
            // Format dates for input fields
            const formatDate = (date) => date.toISOString().split('T')[0];
            
            // Allow any date but show warnings for short notice
            document.getElementById('endDate').setAttribute('min', formatDate(today));
            
            // Add warnings for departure dates
            document.getElementById('startDate').addEventListener('change', function() {
                const selectedDate = new Date(this.value);
                const dayOfWeek = selectedDate.getDay();
                const warningDiv = document.getElementById('dateWarning') || document.createElement('div');
                warningDiv.id = 'dateWarning';
                
                // Check if date is less than 4 business days in advance
                const isShortNotice = selectedDate < recommendedMinDate;
                const isWeekendOrMonday = dayOfWeek === 0 || dayOfWeek === 1;
                
                let warnings = [];
                
                if (isShortNotice) {
                    warnings.push('âš ï¸ <strong>Short Notice:</strong> IT recommends submitting travel requests at least 4 business days in advance for proper system configuration.');
                }
                
                if (isWeekendOrMonday) {
                    warnings.push(`ðŸ“… <strong>Weekend/Monday Departure:</strong> You've selected a ${dayOfWeek === 0 ? 'Sunday' : 'Monday'} departure. IT Support processing occurs during business days only.`);
                }
                
                if (warnings.length > 0) {
                    warningDiv.className = 'alert alert-warning';
                    warningDiv.innerHTML = `
                        <i class="fas fa-exclamation-triangle"></i>
                        <div>
                            ${warnings.map(warning => `<div class="mb-1">${warning}</div>`).join('')}
                            <div class="mt-2 text-sm"><strong>Note:</strong> You can still submit this request, but processing may be delayed.</div>
                        </div>
                    `;
                    if (!document.getElementById('dateWarning')) {
                        document.querySelector('.date-grid').insertAdjacentElement('afterend', warningDiv);
                    }
                } else {
                    if (document.getElementById('dateWarning')) {
                        document.getElementById('dateWarning').remove();
                    }
                }
            });
        });
    </script>
</body>
</html> 